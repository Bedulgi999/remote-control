<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì›ê²© ì œì–´ íŒ¨ë„</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <style>
    body { font-family: sans-serif; background: #f5f5f5; padding: 20px; }
    h1 { color: #333; }
    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    button {
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: #4caf50;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover { background: #388e3c; }
    .card {
      margin-top: 20px;
      padding: 10px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    #current, #history {
      max-height: 250px;
      overflow-y: auto;
      font-size: 14px;
    }
    img { border-radius: 5px; margin-top: 5px; }
  </style>
</head>
<body>
  <h1>ğŸ–¥ï¸ ì›ê²© ì œì–´ íŒ¨ë„</h1>
  <div class="grid">
    <button onclick="sendCommand('!ì •ë³´')">PC ì •ë³´</button>
    <button onclick="sendCommand('!ìƒíƒœ')">ìƒíƒœ í™•ì¸</button>
    <button onclick="sendCommand('!ê°€ë™ì‹œê°„')">ê°€ë™ì‹œê°„</button>
    <button onclick="sendCommand('!ì„¤ì¹˜ëœí”„ë¡œê·¸ë¨')">ì„¤ì¹˜ëœ í”„ë¡œê·¸ë¨</button>
    <button onclick="sendCommand('!ìœ„ì¹˜')">ìœ„ì¹˜ í™•ì¸</button>
    <button onclick="sendCommand('!í´ë¦½ë³´ë“œì½ê¸°')">í´ë¦½ë³´ë“œ</button>
    <button onclick="sendCommand('!pcì¢…ë£Œ')">PC ì¢…ë£Œ</button>
    <button onclick="sendCommand('!pcì¬ì‹œì‘')">PC ì¬ì‹œì‘</button>
    <button onclick="sendCommand('!í”„ë¡œì„¸ìŠ¤ì¢…ë£Œ ë©”ëª¨ì¥')">í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ</button>
    <button onclick="showAlertDialog()">ì•Œë¦¼ì°½</button>
    <button onclick="sendCommand('!ìº¡ì²˜')">í™”ë©´ ìº¡ì²˜</button>
    <button onclick="sendCommand('!ì†ë„ì¸¡ì •')">ì†ë„ ì¸¡ì •</button>
    <button onclick="sendCommand('!ë‹¤ìš´ë¡œë“œ C:/Users/test/file.txt')">íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
    <button onclick="sendCommand('!ìë™ì‹œì‘ë“±ë¡')">ìë™ ì‹œì‘ ë“±ë¡</button>
    <button onclick="sendCommand('!ìë™ì‹œì‘í•´ì œ')">ìë™ ì‹œì‘ í•´ì œ</button>
    <button style="background:#e53935;" onclick="sendCommand('!ì¢…ë£Œ')">ğŸ›‘ í´ë¼ì´ì–¸íŠ¸ ì¢…ë£Œ</button>
  </div>

  <!-- í˜„ì¬ ìƒíƒœ -->
  <div class="card">
    <h2>ğŸ“¡ í˜„ì¬ ìƒíƒœ</h2>
    <div id="current"></div>
  </div>

  <!-- ì‹¤í–‰ ê¸°ë¡ -->
  <div class="card">
    <h2>ğŸ“œ ì‹¤í–‰ ê¸°ë¡ (ìµœê·¼ 10ê°œ)</h2>
    <div id="history"></div>
  </div>

  <script>
    // ğŸ”‘ Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyAaDqg39OROcz22DnZntmwamJhO5dqwt7w",
      authDomain: "site-menu-150a1.firebaseapp.com",
      projectId: "site-menu-150a1",
    };

    // Firebase ì´ˆê¸°í™”
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // âœ… ì»¬ë ‰ì…˜ / ë¬¸ì„œ ì°¸ì¡°
    const commandsRef = db.collection("commands").doc("pc1");
    const logsRef = db.collection("logs");

    // âœ… ëª…ë ¹ ì „ì†¡
    async function sendCommand(cmd) {
      const now = new Date();
      const logDoc = await logsRef.add({
        command: cmd,
        result: "(ëŒ€ê¸° ì¤‘)",
        timestamp: now
      });

      // logs ë¬¸ì„œ IDë¥¼ commandsì— ê°™ì´ ì €ì¥
      await commandsRef.set({
        command: cmd,
        result: "",
        logId: logDoc.id,
        timestamp: now
      }, { merge: true });
    }

    // âœ… ì•Œë¦¼ì°½ ë‹¤ì´ì–¼ë¡œê·¸
    function showAlertDialog() {
      const title = prompt("ì•Œë¦¼ì°½ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”:");
      if (!title) return;
      const content = prompt("ì•Œë¦¼ì°½ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:");
      if (!content) return;
      sendCommand(`!ì•Œë¦¼ì°½ ${title} ${content}`);
    }

    // âœ… í˜„ì¬ ìƒíƒœ (pc1 ë¬¸ì„œ êµ¬ë…)
    commandsRef.onSnapshot(async doc => {
      if (doc.exists) {
        const data = doc.data();
        document.getElementById("current").innerHTML = `
          <p><b>ëª…ë ¹:</b> ${data.command || "(ì—†ìŒ)"}</p>
          <p><b>ê²°ê³¼:</b> ${data.result || "(ëŒ€ê¸° ì¤‘)"}</p>
          <p><b>ì‹œê°„:</b> ${data.timestamp ? data.timestamp.toDate() : "-"}</p>
        `;

        // ğŸ”„ ê²°ê³¼ê°€ ë‚˜ì˜¤ë©´ í•´ë‹¹ log ë¬¸ì„œë„ ì—…ë°ì´íŠ¸
        if (data.logId && data.result) {
          logsRef.doc(data.logId).update({
            result: data.result
          });
        }
      }
    });

    // âœ… ìµœê·¼ ë¡œê·¸ (ìµœê·¼ 10ê°œ)
    logsRef.orderBy("timestamp", "desc").limit(10)
      .onSnapshot(snapshot => {
        let logsHTML = "";
        snapshot.forEach(doc => {
          const data = doc.data();
          let res = data.result;

          // ìº¡ì²˜ëœ ì´ë¯¸ì§€ ì²˜ë¦¬
          if (typeof res === "string" && res.includes("http") && res.includes("capture")) {
            res = `<a href="${res}" target="_blank"><img src="${res}" width="200"></a>`;
          }

          logsHTML += `
            <p>ğŸ•’ ${data.timestamp.toDate().toLocaleString()}<br>
            ğŸ“Œ ëª…ë ¹: ${data.command}<br>
            âœ… ê²°ê³¼: ${res}</p>
            <hr>`;
        });
        document.getElementById("history").innerHTML = logsHTML;
      });
  </script>
</body>
</html>
